<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta lang="ja" />
    <title>タイマー</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
    <link href = "common.css" rel = "stylesheet" type = "text/css" />
    <link href = "timer.css" rel = "stylesheet" type = "text/css" />
</head>
<body>
    <div id = "container">
        <div id = "margin"></div>
        <div id = "timer-box">
            <div id = "min" class = "slide-box"></div>
            <div id = "colon">:</div>
            <div id = "sec" class = "slide-box"></div>
        </div>
    </div>
</body>
<script src = "newDom.js"></script>
<script type="text/javascript">
    var min = 0;
    var sec = 0;
    var timer;
    var isRunning = false;

    function updateTime() {
        const minDivWrapper = document.getElementById("min");
        const secDivWrapper = document.getElementById("sec");

        currentMinDiv = minDivWrapper.getElementsByClassName("in")[0];
        currentSecDiv = secDivWrapper.getElementsByClassName("in")[0];

        minText = ("0" + min).slice(-2);
        secText = ("0" + sec).slice(-2);

        if (currentMinDiv == undefined || currentMinDiv.textContent != minText) {
            newMinDiv = document.createElement("div");
            newMinDiv.textContent = minText;
            showNextDom(minDivWrapper, newMinDiv);
        }

        if (currentSecDiv == undefined || currentSecDiv.textContent != secText) {
            newSecDiv = document.createElement("div");
            newSecDiv.textContent = secText;
            showNextDom(secDivWrapper, newSecDiv);
        }
    }

    // countdown timer
    function countDown() {
        sec--;
        if (sec < 0) {
            min--;
            sec = 59;
        }
        if (min < 0) {
            clearInterval(timer);
            isRunning = false;
            min = 0;
            sec = 0;
        }
        updateTime();
    }

    // start or stop the timer
    function startStop() {
        if (isRunning) {
            clearInterval(timer);
            isRunning = false;
        } else {
            timer = setInterval(countDown, 1000);
            isRunning = true;
        }
    }

    // reset the timer
    function reset() {
        if (isRunning) {
            clearInterval(timer);
            isRunning = false;
        }
        min = 5;
        sec = 0;

        updateTime();
    }

    nodecg.listenFor("startStop", startStop);
    nodecg.listenFor("reset", reset);
    reset();
</script>
</html>
